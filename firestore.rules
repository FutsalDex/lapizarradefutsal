rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Permite la lectura p√∫blica de ejercicios, pero la escritura solo a usuarios autenticados.
    match /exercises/{exerciseId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Permite a los usuarios leer y escribir sus propios datos.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Permite a los usuarios leer y escribir en sus propios equipos y subcolecciones.
    match /teams/{teamId}/{document=**} {
      allow read, write: if request.auth != null && get(/databases/$(database)/documents/teams/$(teamId)).data.ownerId == request.auth.uid;
    }
    
    // Permite a los miembros del equipo leer y escribir en los equipos a los que pertenecen.
    match /teamMembers/{memberId} {
      allow read, write: if request.auth != null;
    }

    // Permite a los usuarios autenticados gestionar sus partidos.
    match /matches/{matchId} {
      allow read, write: if request.auth != null;
    }

    // Permite a los usuarios autenticados gestionar sus sesiones.
    match /sessions/{sessionId} {
        allow read, write: if request.auth != null;
    }

    // Permite a los usuarios autenticados gestionar las invitaciones.
    match /invitations/{invitationId} {
        allow read, write: if request.auth != null;
    }
  }
}